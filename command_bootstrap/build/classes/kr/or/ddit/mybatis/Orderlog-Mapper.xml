<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Orderlog-Mapper">

<!-- 	<sql id="search"> -->
<!-- 		<if test="searchType == 's'.toString()"> -->
<!-- 			and ORDER_STATUS like '%'||#{keyword}||'%' -->
<!-- 		</if> -->
<!-- 		<if test="searchType == 'd'.toString()"> -->
<!-- 			and BUY_DATE like '%'||#{keyword}||'%' -->
<!-- 		</if> -->
<!-- 	</sql> -->


	<select id="selectSearchOrderlogList" resultType="orderlog">
		SELECT * 
		FROM ORDER_LOG
		WHERE USER_ID = #{userId}
		ORDER BY ORDER_ID DESC
	</select>
	

	<select id="selectSearchOrderlogListCount" resultType="int">
		SELECT
		COUNT(*)
		FROM ORDER_LOG
		WHERE USER_ID = #{userId}
<!-- 		<include refid="search" /> -->
		ORDER BY ORDER_ID DESC
	</select>
	
	<select id="selectSearchOrderlogDetailListCount" resultType="int">
		SELECT
		COUNT(*)
		FROM ORDER_LOG_DETAIL
		WHERE ORDER_ID = #{orderId}
<!-- 		<include refid="search" /> -->
		ORDER BY ORDER_ID DESC
	</select>
	
	
	
	
	
	<select id="selectOrderlogListByOrderId" resultType="orderlog">
		SELECT *
		FROM ORDER_LOG
		WHERE ORDER_ID = #{orderId}
	</select>
	
	<select id="selectOrderlogDetailListByOrderId" resultType="orderlogprod">
		SELECT 
		O.*,
		D.ORDER_DETAIL_NO,
		D.ORDERDETAIL_STATUS,
		P.PROD_ID,
		P.PROD_NAME,
		P.PROD_QTY,
		P.PROD_IMG
		FROM 
			ORDER_LOG O
		INNER JOIN 
			ORDER_LOG_DETAIL D
		ON 
			O.ORDER_ID = D.ORDER_ID
		INNER JOIN 
			PRODUCT P
		ON 
			D.PROD_ID = P.PROD_ID
		WHERE 
			O.ORDER_ID = #{orderId}
	</select>
	
	<update id="modifyOrderlog" parameterType="orderlog">
		UPDATE ORDER_LOG
		SET
		ORDER_ID = #{orderId}
		<if test="orderStatus != null">
		,ORDER_STATUS=#{orderStatus}
		</if>
		where ORDER_ID=#{orderId}		
	</update>
	
	
	<update id="registOrderlog">
		insert into
		order_log(USER_ID,BUY_DATE,ORDER_STATUS,ORDER_ID)
		values(#{userId},#{buyDate},#{orderStatus},#{orderId})
	</update>
	
	
	<update id="registOrderlogDetail">
		insert into
		order_log_detail(ORDER_DETAIL_NO,PROD_ID,PROD_QTY,ORDER_ID,ORDERDETAIL_STATUS)
		values(#{orderDetailNo},#{prodId},#{orderId},#{orderDetailStatus})
	</update>
	
	<select id="selectOrderlogNextVal" resultType="int">
		SELECT ORDER_SEQ.NEXTVAL FROM DUAL;
	</select>
	
	<select id="selectOrderDetaillogNextVal" resultType="int">
		SELECT ORDERDETAIL_SEQ.NEXTVAL FROM DUAL;
	</select>




<!-- 	<select id="selectMemberById" parameterType="str" -->
<!-- 		resultType="order"> -->
<!-- 		SELECT * -->
<!-- 		FROM ORDER -->
<!-- 		WHERE ORDER_ID = #{orderId} -->
<!-- 	</select> -->

<!-- 	<select id="selectMemberList" resultType="order"> -->
<!-- 		select -->
<!-- 		* -->
<!-- 		from ORDER -->
<!-- 	</select> -->


<!-- 	<update id="updateMember" parameterType="order"> -->
<!-- 		update ORDER -->
<!-- 		set -->
<!-- 		pwd=#{pwd}, email=#{email}, phone=#{phone}, -->
<!-- 		name=#{name}, picture=#{picture} -->

<!-- 		<if test="authority != null"> -->
<!-- 			, authority=#{authority} -->
<!-- 		</if> -->
<!-- 		where ORDER_ID=#{orderId} -->
<!-- 	</update> -->

<!-- 	<update id="disabledMember"> -->
<!-- 		update ORDER -->
<!-- 		set enabled=0 -->
<!-- 		where ORDER_ID=#{orderId} -->
<!-- 	</update> -->

<!-- 	<update id="enabledMember"> -->
<!-- 		update ORDER -->
<!-- 		set enabled=1 -->
<!-- 		where ORDER_ID=#{orderId} -->
<!-- 	</update> -->

</mapper>